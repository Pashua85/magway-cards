var f=Object.defineProperty;var C=(r,e,n)=>e in r?f(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n;var d=(r,e,n)=>C(r,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(t){if(t.ep)return;t.ep=!0;const s=n(t);fetch(t.href,s)}})();const h=({navigationWrapper:r,background:e})=>{r==null||r.classList.toggle("navigation__wrapper_open"),e==null||e.classList.toggle("navigation__wrapper-background_open"),document.body.classList.toggle("body_stop-scrolling")},L=()=>{addEventListener("DOMContentLoaded",r=>{const e=document.querySelector("#menu-toggle"),n=document.querySelector(".navigation__wrapper"),o=document.querySelector(".navigation__wrapper-background");e==null||e.addEventListener("click",()=>{h({navigationWrapper:n,background:o})}),o==null||o.addEventListener("click",()=>{h({navigationWrapper:n,background:o})}),n==null||n.addEventListener("click",t=>{var a;const s=Array.from(((a=t.target)==null?void 0:a.classList)??[]);["navigation__link","button__icon","button__text","nav-menu-buttons__button"].some(c=>s.includes(c))&&h({navigationWrapper:n,background:o})})})},m="https://jsonplaceholder.typicode.com",g="/assets";function y(r,e){return Math.floor(Math.random()*(e-r+1)+r)}class E{constructor({loadButtonSelector:e,spinnerContainerSpinner:n,maxCardsAmount:o,cardsContainerSelector:t,preloadedCardsAmount:s}){d(this,"loadedCardLength",0);d(this,"loadButton",null);d(this,"cardsContainer",null);d(this,"spinnerContainer",null);d(this,"usersMap",{});d(this,"maxCardsAmount",30);this.loadButton=document.querySelector(e),this.spinnerContainer=document.querySelector(n),this.cardsContainer=document.querySelector(t),s&&(this.loadedCardLength+=s),o&&(this.maxCardsAmount=o),this.addLoadListener()}addLoadListener(){var e;(e=this.loadButton)==null||e.addEventListener("click",()=>{this.loadCards()})}openSpinner(){var e;(e=this.spinnerContainer)==null||e.classList.add("spinner__container_open")}closeSpinner(){var e;(e=this.spinnerContainer)==null||e.classList.remove("spinner__container_open")}async loadCards(e=5){if(!(this.loadedCardLength>=this.maxCardsAmount))try{this.openSpinner(),this.loadButton.disabled=!0;const n=await this.fetchPosts(e),o=await this.addUsersToPosts(n),t=document.createDocumentFragment();o.forEach(s=>{const a=this.createCardElement(s);t.appendChild(a)}),this.closeSpinner(),this.loadButton.disabled=!1,this.cardsContainer.appendChild(t),this.loadedCardLength+=o.length,this.loadedCardLength>=this.maxCardsAmount&&this.disabledButton()}catch(n){this.closeSpinner(),this.loadButton.disabled=!1,console.error("Ошибка получения данных",n)}}fetchPosts(e=5){return fetch(`${m}/posts?_start=${this.loadedCardLength}&_limit=${e}`).then(n=>n.json())}disabledButton(){this.loadButton.disabled=!0}async addUsersToPosts(e){const o=[...new Set((e??[]).map(t=>t.userId))].filter(t=>!this.usersMap[t]);return o.length&&(await Promise.all(o.map(s=>fetch(`${m}/users/${s}`).then(a=>a.json())))).forEach(s=>{this.usersMap[s.id]=s.username}),e.map(t=>({...t,username:this.usersMap[t.userId]??""}))}createCardElement(e){const n=document.createElement("article");n.classList.add("card");const o=document.createElement("img");o.classList.add("card__image"),o.src=`${g}/coin-${y(1,10)}.jpg`,o.alt="coin",n.appendChild(o);const t=document.createElement("div");t.classList.add("card__content"),n.appendChild(t);const s=document.createElement("h3");s.classList.add("card__header"),s.textContent=e.title,t.appendChild(s);const a=document.createElement("p");a.classList.add("card__subtitle"),a.textContent="Added cards from /posts",t.appendChild(a);const c=document.createElement("p");c.classList.add("card__text"),c.textContent=e.body,t.appendChild(c);const i=document.createElement("p");i.classList.add("card__publish-info");const p=document.createElement("span");p.textContent="Posted by ",i.appendChild(p);const u=document.createElement("span");u.classList.add("card__publish-info_bold"),u.textContent=e.username,i.appendChild(u);const _=document.createElement("span");_.textContent=", on July  24, 2019",t.appendChild(i);const l=document.createElement("a");return l.href="#",l.classList.add("card__button"),l.textContent="Continue reading",t.appendChild(l),n}}L();new E({loadButtonSelector:"#load-button",spinnerContainerSpinner:".spinner__container",cardsContainerSelector:".cards-section__cards-container",preloadedCardsAmount:10});
