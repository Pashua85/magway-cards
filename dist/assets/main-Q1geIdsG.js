var f=Object.defineProperty;var _=(a,e,n)=>e in a?f(a,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[e]=n;var d=(a,e,n)=>_(a,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(t){if(t.ep)return;t.ep=!0;const s=n(t);fetch(t.href,s)}})();const C=()=>{addEventListener("DOMContentLoaded",a=>{const e=document.querySelector("#menu-toggle"),n=document.querySelector(".navigation__wrapper");e==null||e.addEventListener("click",()=>{n==null||n.classList.toggle("navigation__wrapper_open")}),n==null||n.addEventListener("click",r=>{var s;const t=Array.from(((s=r.target)==null?void 0:s.classList)??[]);["navigation__link","button__icon","button__text","nav-menu-buttons__button"].some(o=>t.includes(o))&&(n==null||n.classList.toggle("navigation__wrapper_open"))})})},p="https://jsonplaceholder.typicode.com";function L(a,e){return Math.floor(Math.random()*(e-a+1)+a)}class g{constructor({loadButtonSelector:e,spinnerContainerSpinner:n,maxCardsAmount:r,cardsContainerSelector:t,preloadedCardsAmount:s}){d(this,"loadedCardLength",0);d(this,"loadButton",null);d(this,"cardsContainer",null);d(this,"spinnerContainer",null);d(this,"usersMap",{});d(this,"maxCardsAmount",30);this.loadButton=document.querySelector(e),this.spinnerContainer=document.querySelector(n),this.cardsContainer=document.querySelector(t),s&&(this.loadedCardLength+=s),r&&(this.maxCardsAmount=r),this.addLoadListener()}addLoadListener(){var e;(e=this.loadButton)==null||e.addEventListener("click",()=>{console.log("add click"),this.loadCards()})}openSpinner(){var e;(e=this.spinnerContainer)==null||e.classList.add("spinner__container_open")}closeSpinner(){var e;(e=this.spinnerContainer)==null||e.classList.remove("spinner__container_open")}async loadCards(e=5){if(!(this.loadedCardLength>=this.maxCardsAmount))try{this.openSpinner();const n=await this.fetchPosts(e),r=await this.addUsersToPosts(n),t=document.createDocumentFragment();r.forEach(s=>{const o=this.createCardElement(s);t.appendChild(o)}),this.closeSpinner(),this.cardsContainer.appendChild(t),this.loadedCardLength+=r.length,this.loadedCardLength>=this.maxCardsAmount&&this.disabledButton()}catch(n){console.error("Ошибка получения данных",n)}}fetchPosts(e=5){return fetch(`${p}/posts?_start=${this.loadedCardLength}&_limit=${e}`).then(n=>n.json())}disabledButton(){this.loadButton.disabled=!0}async addUsersToPosts(e){const r=[...new Set((e??[]).map(t=>t.userId))].filter(t=>!this.usersMap[t]);return r.length&&(await Promise.all(r.map(s=>fetch(`${p}/users/${s}`).then(o=>o.json())))).forEach(s=>{this.usersMap[s.id]=s.username}),e.map(t=>({...t,username:this.usersMap[t.userId]??""}))}createCardElement(e){const n=document.createElement("article");n.classList.add("card");const r=document.createElement("img");r.classList.add("card__image"),r.src=`./src/assets/coin-${L(1,10)}.jpg`,r.alt="coin",n.appendChild(r);const t=document.createElement("div");t.classList.add("card__content"),n.appendChild(t);const s=document.createElement("h3");s.classList.add("card__header"),s.textContent=e.title,t.appendChild(s);const o=document.createElement("p");o.classList.add("card__subtitle"),o.textContent="Added cards from /posts",t.appendChild(o);const l=document.createElement("p");l.classList.add("card__text"),l.textContent=e.body,t.appendChild(l);const c=document.createElement("p");c.classList.add("card__publish-info");const h=document.createElement("span");h.textContent="Posted by ",c.appendChild(h);const u=document.createElement("span");u.classList.add("card__publish-info_bold"),u.textContent=e.username,c.appendChild(u);const m=document.createElement("span");m.textContent=", on July  24, 2019",t.appendChild(c);const i=document.createElement("a");return i.href="#",i.classList.add("card__button"),i.textContent="Continue reading",t.appendChild(i),n}}C();new g({loadButtonSelector:"#load-button",spinnerContainerSpinner:".spinner__container",cardsContainerSelector:".cards-section__cards-container",preloadedCardsAmount:10});
